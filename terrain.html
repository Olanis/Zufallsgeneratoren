<updates>
  <update>
    <pattern>.*</pattern>
    <replacement>&lt;!DOCTYPE html&gt;
&lt;html lang="de"&gt;
&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;title&gt;Terrain-Generator&lt;/title&gt;
  &lt;style&gt;
    body { font-family: sans-serif; padding: 2em; max-width: 900px; margin: auto; }
    button { font-size: 1em; padding: 0.5em; margin: 1em 0.5em 0 0; }
    .output { margin-top: 1em; font-weight: bold; white-space: pre-line; }
    .neighbor-group { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1em; }
    .neighbor { display: flex; flex-direction: column; position: relative; }
    .dropdown-button {
      padding: 0.5em;
      cursor: pointer;
      border: 1px solid #ccc;
      border-radius: 5px;
      background-color: white;
      width: 100%;
      text-align: left;
      position: relative;
      min-height: 2.5em;
    }
    .dropdown-button::after {
      content: '‚ñº';
      position: absolute;
      right: 10px;
    }
    .dropdown-menu {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      max-height: 200px;
      overflow-y: auto;
      background-color: white;
      border: 1px solid #ccc;
      border-radius: 5px;
      z-index: 1000;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .dropdown.open .dropdown-menu {
      display: block;
    }
    .terrain-item { display: flex; align-items: center; gap: 0.5em; padding: 0.3em 0.5em; }
    .terrain-item:hover { background-color: #f0f0f0; }
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;

  &lt;h2&gt;‚õ∞Ô∏è Terrain-Generator (Dropdown-Version)&lt;/h2&gt;

  &lt;div class="neighbor-group" id="neighborInputs"&gt;&lt;/div&gt;

  &lt;button onclick="generateTerrain()"&gt;Terrain generieren&lt;/button&gt;
  &lt;button onclick="resetSelections()"&gt;üîÑ Reset&lt;/button&gt;
  &lt;button onclick="goBack()"&gt;üîô Zur√ºck&lt;/button&gt;

  &lt;div class="output" id="terrainOutput"&gt;&lt;/div&gt;

  &lt;script&gt;
    const directions = ['N', 'NO', 'O', 'SO', 'S', 'SW', 'W', 'NW'];

    const baseTerrains = {
      "Meer": ["Meer", "Tiefsee", "Kaltwassermeer", "Stilles Meer", "Gezeitenk√ºste", "Sturmsee"],
      "See": ["See", "Kratersee", "Klarwassersee", "Steppensee", "Moossee", "Bergsee"],
      "Fluss": ["Fluss", "Nebenarm", "Gebirgsfluss", "Deltaschlucht", "Schwemmland", "Verzweigter Fluss"],
      "Gebirge": ["Gebirge", "Kammgebirge", "Zerkl√ºftetes Gebirge", "Hochgebirge", "Basaltklippen", "Granitberge"],
      "Savanne": ["Savanne", "Trockensavanne", "Steinige Savanne", "H√ºgelsavanne", "Offene Savanne", "Baumsavanne"],
      "Dschungel": ["Dschungel", "Bergdschungel", "Nebeldschungel", "Urwaldrand", "Feuchtdschungel", "Tieflanddschungel"],
      "W√ºste": ["W√ºste", "Sandw√ºste", "Steinw√ºste", "Salzw√ºste", "Kiesw√ºste", "Felsw√ºste"],
      "Wald": ["Wald", "Laubwald", "Mischwald", "Dichter Wald", "Nadelwald", "Bergwald"],
      "Mangrovenwald": ["Mangrovenwald", "Tidenwald", "Salzwasserwald", "Wurzelwald", "Feuchtwald", "K√ºstenhain"],
      "K√ºste": ["K√ºste", "Sandk√ºste", "Felsenk√ºste", "Steilk√ºste", "Lagune", "Kiesstrand"],
      "Hochebene": ["Hochebene", "Felsplateau", "Trockene Hochebene", "Windebene", "Grasplateau", "Steppenhochland"],
      "Steppe": ["Steppe", "Grassteppe", "Trockensteppe", "Windsteppe", "Felsensteppe", "Kaltsteppe"],
      "Tundra": ["Tundra", "Flechtensteppe", "Frostboden", "Eisgrasland", "Kargtundra", "Moortundra"],
      "Taiga": ["Taiga", "Nadeltaiga", "Moostaiga", "Frostwald", "Schneetaiga", "Lichttaiga"],
      "Sumpf": ["Sumpf", "Bruchsumpf", "Wurzelsumpf", "Dunkelsumpf", "Feuchtsumpf", "Flachsumpf"],
      "Moorland": ["Moorland", "Heidemoor", "Torfland", "Schilfmoor", "Waldmoor", "Kaltmoor"],
      "Pr√§rie": ["Pr√§rie", "Graspr√§rie", "Trockene Pr√§rie", "Buschpr√§rie", "H√ºgelpr√§rie", "Bl√ºtenpr√§rie"],
      "Insel": ["Insel", "Vulkaninsel", "Koralleninsel", "Klippeninsel", "Sandinsel", "Dschungelinsel"],
      "Halbinsel": ["Halbinsel", "Sandhalbinsel", "Felsige Halbinsel", "Bewaldete Halbinsel", "Niedrige Halbinsel", "Windhalbinsel"],
      "Grasland": ["Grasland", "Feuchtgrasland", "Trockenwiese", "H√ºgelgrasland", "Ebenes Grasland", "Hochgrasfl√§che"],
      "Heide": ["Heide", "Bl√ºtenheide", "Kiesheide", "H√ºgelheide", "Feuchte Heide", "Trockene Heide"],
      "Felsk√ºste": ["Felsk√ºste", "Brandungsk√ºste", "Klippenk√ºste", "Steinstrand", "Windk√ºste", "Ger√∂llk√ºste"],
      "Savannengrasland": ["Savannengrasland", "Offenes Grasland", "Steppengras", "Buschgrasland", "Trockengrasland", "Savanneng√ºrtel"],
      "Bambuswald": ["Bambuswald", "Hochbambuswald", "Feuchtbambus", "Lichtbambus", "Bergbambus", "Dichtbambus"],
      "Hochmoor": ["Hochmoor", "Torfboden", "Nebelmoor", "Grasmoor", "Wasserhochland", "Frostmoor"],
      "Archipel": ["Archipel", "Inselgruppe", "Felsarchipel", "Tropenarchipel", "Korallenarchipel", "Windarchipel"]
    };

    const groupedA = {
      "kalt": ["Tundra", "Taiga", "Hochmoor"],
      "trocken": ["W√ºste", "Steppe", "Moorland", "Heide"],
      "feucht": ["Wald", "Sumpf", "Fluss", "See", "Grasland", "Bambuswald"],
      "maritim": ["Meer", "K√ºste", "Insel", "Archipel", "Felsk√ºste", "Mangrovenwald"],
      "bergig": ["Gebirge", "Hochebene", "Hochmoor"]
    };

    function getClimateZone(terrainType) {
      for (const [zone, types] of Object.entries(groupedA)) {
        if (types.includes(terrainType)) return zone;
      }
      return null;
    }

    function getSelectedTerrains() {
      const selected = [];
      document.querySelectorAll('.dropdown-menu input[type=checkbox]:checked').forEach(cb => selected.push(cb.value));
      return selected;
    }

    function isCompatible(terrain, neighbors) {
      const base = Object.keys(baseTerrains).find(k => baseTerrains[k].includes(terrain));
      const zone = getClimateZone(base);
      return neighbors.every(n => {
        const nZone = getClimateZone(n);
        return !nZone || nZone === zone;
      });
    }

    function generateTerrain() {
      const selected = getSelectedTerrains();
      let weighted = [];

      for (const [type, variations] of Object.entries(baseTerrains)) {
        variations.forEach((v, i) =&gt; {
          const rarity = (v === type) ? 10 : 1;
          for (let r = 0; r &lt; rarity; r++) weighted.push(v);
        });
      }

      const results = [];
      let attempts = 0;

      while (results.length &lt; 3 &amp;&amp; attempts &lt; 1000) {
        const candidate = weighted[Math.floor(Math.random() * weighted.length)];
        if (isCompatible(candidate, selected)) {
          const source = selected.includes(candidate) ? "Aus Nachbarn" : "Zuf√§llig";
          results.push(`${source}: ${candidate}`);
        }
        attempts++;
      }

      document.getElementById("terrainOutput").textContent = results.length
        ? results.join("\n")
        : "‚ö†Ô∏è Kein passendes Terrain gefunden.";
    }

    function resetSelections() {
      document.querySelectorAll('input[type=checkbox]').forEach(cb =&gt; cb.checked = false);
      document.querySelectorAll('.dropdown-button').forEach(btn =&gt; btn.textContent = btn.textContent.split(' ')[0] + ' 0/3');
    }

    function goBack() {
      window.history.back();
    }

    function createDropdown(name) {
      const wrapper = document.createElement("div");
      wrapper.className = "dropdown";

      const button = document.createElement("div");
      button.className = "dropdown-button";
      button.textContent = name + " 0/3";

      const menu = document.createElement("div");
      menu.className = "dropdown-menu";

      const checkboxes = [];

      for (const type of Object.keys(baseTerrains)) {
        const item = document.createElement("label");
        item.className = "terrain-item";

        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.value = type;
        cb.addEventListener("change", () =&gt; {
          const count = checkboxes.filter(c =&gt; c.checked).length;
          button.textContent = `${name} ${count}/3`;
          checkboxes.forEach(c =&gt; {
            if (!c.checked) c.disabled = count &gt;= 3;
          });
        });

        item.appendChild(cb);
        item.appendChild(document.createTextNode(type));
        menu.appendChild(item);
        checkboxes.push(cb);
      }

      wrapper.appendChild(button);
      wrapper.appendChild(menu);

      button.addEventListener("click", (e) =&gt; {
        e.stopPropagation();
        document.querySelectorAll(".dropdown").forEach(d =&gt; { if (d !== wrapper) d.classList.remove("open"); });
        wrapper.classList.toggle("open");
      });

      menu.addEventListener("click", (e) =&gt; e.stopPropagation());
      document.addEventListener("click", () =&gt; {
        document.querySelectorAll(".dropdown").forEach(d =&gt; d.classList.remove("open"));
      });

      return wrapper;
    }

    function createNeighborInputs() {
      const container = document.getElementById("neighborInputs");
      container.innerHTML = "";
      directions.forEach(dir =&gt; {
        const wrapper = document.createElement("div");
        wrapper.className = "neighbor";

        const label = document.createElement("label");
        label.textContent = dir;
        wrapper.appendChild(label);

        const dropdown = createDropdown(dir);
        wrapper.appendChild(dropdown);

        container.appendChild(wrapper);
      });
    }

    window.onload = createNeighborInputs;
  &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</replacement>
  </update>
</updates>
